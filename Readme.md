# 基于ZYNQ-7020的实时音频分析仪

## 项目描述

本项目基于Xilinx ZYNQ-7020 SoC开发板，实现了一个高性能的实时音频分析仪。系统通过FPGA（PL端）对音频信号进行高速采集、缓冲和FFT频谱分析，并运用自定义算法实时识别音频类别（无声音、人声、纯音乐）。处理结果通过ARM处理器（PS端）打包后经由串口发送至上位机显示。

## 核心功能：

·   实时音频处理： 48kHz采样率，4096点FFT，频率分辨率约11.7Hz。

·   音频分类： 能够快速识别无声音、人声和纯音乐。

·   峰值检测： 实时输出信号中最大功率对应的频率值。

·   实时监听： 采集的音频信号可实时通过DAC和功放播放。

·   上位机通信： 通过UART以JSON格式向上位机报告分析结果。

## 系统架构

### 硬件平台

·   主控芯片: Xilinx Zynq-7020 (XC7Z020CLG400-1)

·   ADC: 8位并行ADC，用于音频采样

·   DAC: 用于音频实时输出监听

·   音频输入: 驻极体麦克风

### 顶层设计

·   顶层文件: FFT_FIFO

### PL端（FPGA）逻辑设计

PL端负责所有高速、实时的信号处理任务，主要模块如下：

1. 时钟管理 (Clocking Wizard)
   ·   生成系统所需的各种时钟，并通过分频产生驱动ADC/DAC的48kHz主时钟。
2. 数据采集与输出 (AD_DA_tran)
   ·   控制ADC采样，并将采集到的数据存入寄存器，同时送至DAC实现实时音频输出监听。
3. 数据缓冲 (FIFO)
   ·   采用深度为4097的同步FIFO，作为ADC与FFT IP核之间的数据缓冲区。

   ·   内含计数器，用于生成 tdata_last 信号，实现与FFT IP核的AXI-Stream总线握手。
4. 频谱计算 (FFT IP核)
   ·   配置为 Radix-4, Burst I/O 模式，变换点数4096。

   ·   通过AXI-Stream总线从FIFO读取数据，输出顺序格式的复数频谱结果。
5. 功率谱计算 (Multiple_power)
   ·   为简化计算并满足分类需求，直接计算FFT输出（实部、虚部）的平方和作为功率谱，替代需要开根号的幅度谱。
6. 峰值查找 (Peak_find)
   ·   阈值滤波： 设置功率阈值，筛选出有效的功率峰值，忽略噪声。

   ·   静音检测： 设置功率有效阈值。若连续6帧数据的最大功率均低于此阈值，则判定为“无声音”。
7. 音频分类 (Peak_classify)
   ·   分堆统计： 根据预设的“语音-音乐”区分阈值，将有效峰值划分为低频（语音区）和高频（音乐区）。

   ·   滑动判决： 采用滑动窗口和二分比较逻辑。当某一区域的峰值数量超过另一区域并达到设定的比较阈值时，触发分类判决（人声或音乐）。否则，滑动数据窗口继续分析。

   ·   状态指示： 输出 voice, music, busy, max 信号至PL端LED，直观显示系统状态。
8. 调试 (Ila 逻辑分析仪)
   ·   用于内部信号抓取和系统调试。
9. 系统集成 (FIFO_to_FFT)
   ·   顶层连接模块，将上述所有模块互联，并输出关键控制信号。

### PS端（ARM）软件设计

PS端负责系统控制与通信。

1. ZYNQ Processing System:
   ·   配置ZYNQ处理器，启用UART0，并引出16个EMIO用于与PL端通信。
2. 逻辑控制:
   ·   通过EMIO读取PL端送来的分类结果、最大功率频点索引、状态信号等。
3. 数据转换与上报:
   ·   将频率索引值转换为实际频率值（单位：Hz）。

   ·   将结果按特定协议格式（JSON）封装，通过UART0（波特率115200）发送给上位机。

## 使用说明

1. ### 硬件连接:

   ·   将麦克风连接至ADC输入。

   ·   将DAC输出连接至耳机或功放。

   ·   连接JTAG用于调试/下载。

   ·   连接UART0（USB转串口）至PC，用于与上位机通信。
2. ### 编译与部署:

   ·   使用Vivado打开硬件工程，综合、实现、生成比特流。

   ·   导出硬件（包括比特流文件）至Vitis开发环境。

   ·   在Vitis中创建/打开应用工程，编译PS端应用程序。

   ·   通过JTAG将比特流和应用程序下载至ZYNQ-7020开发板。
3. ### 运行与观察:

   ·   系统启动后，PL端LED将显示当前工作状态。

   ·   打开PC上的串口上位机（如PuTTY、串口助手或定制网页），设置波特率为115200，即可接收并显示实时分析结果。

## 关键参数

   ·   采样率： 48 kHz

   ·   FFT点数： 4096

   ·   频率分辨率： ~11.7 Hz

   ·   FFT模式： Radix-4, Burst I/O

   ·   总线协议： AXI-Stream

   ·   串口通信波特率： 115200

## 队伍名

·   [我要成为FPGA高手队]
